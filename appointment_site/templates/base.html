<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="{% block description %}בדיקת תורים לחידוש דרכון ותעודת זהות - התראות וזמינות בסניפים קרובים{% endblock %}" />
  <link rel="canonical" href="{{ request.url }}" />
  <title>{% block title %}BookGov - תורים לחידוש דרכון ות"ז{% endblock %}</title>

  <!-- Preconnect to external domains for faster resource loading -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">

  <!-- Google Fonts: Heebo for Hebrew -->
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  
  <!-- Persisted theme to avoid FOUC -->
  <script>
    (function() {
      try { if (localStorage.getItem('theme') === 'dark') document.documentElement.classList.add('dark'); } catch(e) {}
    })();
  </script>

  <!-- Your custom CSS - keeping original structure -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  <link href="{{ url_for('static', filename='css/appointments_table.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='css/distanceFilter.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='css/theme.css') }}" rel="stylesheet" />
  <!-- FAQ CSS - loads last to ensure it overrides all other styles -->
  <link href="{{ url_for('static', filename='css/faq.css') }}" rel="stylesheet" />
  <!-- Filter Drawer CSS - loads after FAQ to ensure it overrides all other styles -->
  <link href="{{ url_for('static', filename='css/filter_drawer.css') }}" rel="stylesheet" />
  <!-- Mobile CSS - loads last to ensure mobile overrides work properly -->
  <link href="{{ url_for('static', filename='css/mobile.css') }}" rel="stylesheet" />

  <!-- Force dark mode styles to load after all other CSS -->
  <style>
    .navbar-nav .nav-link { font-size: 1.1rem; font-weight: 500; }
    .navbar-nav { margin: 0 auto; }
    
    /* Fix navbar-toggler positioning - ensure it stays in header */
    .navbar-toggler {
      position: static !important;
      transform: none !important;
      transition: none !important;
      margin: 0 !important;
      top: auto !important;
      left: auto !important;
      right: auto !important;
      bottom: auto !important;
    }
    
    /* Ensure navbar container maintains structure */
    .navbar .container-fluid {
      position: relative !important;
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
    }
    
    /* Mobile-specific navbar fixes */
    @media (max-width: 991.98px) {
      .navbar-toggler {
        position: static !important;
        order: 3 !important;
        flex-shrink: 0 !important;
      }
      
      .navbar-collapse {
        position: absolute !important;
        top: 100% !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 1000 !important;
      }
    }
    
    /* Theme toggle button styling */
    #themeToggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
    }
    
    .theme-icon {
      flex-shrink: 0;
      vertical-align: middle;
    }
    
    #themeText {
      white-space: nowrap;
    }
    
    /* Test dark mode styles inline */
    html.dark * {
      color: white !important;
    }
    
    html.dark h1,
    html.dark h2,
    html.dark h3,
    html.dark h4,
    html.dark h5,
    html.dark h6,
    html.dark p,
    html.dark span,
    html.dark div,
    html.dark label {
      color: white !important;
    }
    
    
    /* Test with hardcoded colors */
    html.dark .navbar-brand,
    html.dark .nav-link,
    html.dark .navbar-nav,
    html.dark .container,
    html.dark .card,
    html.dark .card-body,
    html.dark .table,
    html.dark .table th,
    html.dark .table td {
      color: #ffffff !important;
    }

    /* Force all text to be white */
    html.dark * {
      color: #ffffff !important;
    }

    /* Specific overrides for all text elements */
    html.dark h1,
    html.dark h2,
    html.dark h3,
    html.dark h4,
    html.dark h5,
    html.dark h6,
    html.dark p,
    html.dark span,
    html.dark div,
    html.dark label,
    html.dark .hero-subtitle,
    html.dark .section-heading,
    html.dark .divider-text,
    html.dark .step-header,
    html.dark .step-content,
    html.dark .location-options,
    html.dark .info-alert,
    html.dark .alert-info,
    html.dark .highlight-text,
    html.dark .faq-container,
    html.dark .navbar-nav .nav-link,
    html.dark .navbar-brand,

    html.dark .form-label,
    html.dark .text-muted,
    html.dark .text-dark,
    html.dark .text-black,
    html.dark .text-body,
    html.dark .text-secondary,
    html.dark .text-body-secondary,
    html.dark .bg-white,
    html.dark .bg-light,
    html.dark .bg-dark,
    html.dark .border,
    html.dark .card,
    html.dark .card-body,
    html.dark .table,
    html.dark .table th,
    html.dark .table td,
    html.dark .table-striped > tbody > tr:nth-of-type(odd) > td,
    html.dark .table-striped > tbody > tr:nth-of-type(even) > td,
    html.dark .table-bordered,
    html.dark .table-hover > tbody > tr:hover > td,
    html.dark caption,
    html.dark input,
    html.dark input::placeholder,
    html.dark [class*="text-"],
    html.dark .text-danger,
    html.dark .text-warning,
    html.dark .text-success,
    html.dark .text-info,
    html.dark .text-primary,
    html.dark .luxury-text-charcoal,
    html.dark .luxury-text-slate {
      color: #ffffff !important;
    }

    /* Force override for any remaining text elements with maximum specificity */
    html.dark *:not(.btn):not(.btn-primary):not(.btn-secondary):not(.btn-outline):not(.btn-outline-primary):not(.btn-outline-secondary):not(.step-badge):not(.action-btn):not(.table-action-btn):not(.distance-btn):not(.appointments-icon):not(.distance-filter-icon):not(.distance-info-icon):not(.filter-icon):not(.alert-icon):not(.availability-status.available):not(.availability-status.limited):not(.availability-status.unavailable):not(h1):not(.hero-title) {
      color: #ffffff !important;
    }

    /* Additional specificity for common elements */
    html.dark .container *,
    html.dark .row *,
    html.dark .col *,
    html.dark .card *,
    html.dark .navbar *,
    html.dark .nav *,
    html.dark .table *,
    html.dark .form * {
      color: #ffffff !important;
    }

    /* HTML.dark filter drawer overrides */
    html.dark .luxury-filter-drawer {
              background: linear-gradient(135deg, rgba(30, 58, 138, 0.1) 0%, rgba(15, 23, 42, 0.05) 100%) !important;
      border-left: 1px solid rgba(37, 99, 235, 0.3);
    }

    html.dark .luxury-filter-drawer .offcanvas-title {
      color: #ffffff !important;
    }

    html.dark .luxury-filters-accordion .accordion-button {
      color: #ffffff !important;
    }

    html.dark .luxury-filters-accordion .accordion-button:not(.collapsed) {
      color: #ffffff !important;
    }

    html.dark .luxury-filters-accordion .accordion-body {
      color: #ffffff !important;
    }

    html.dark .filter-section-title {
      color: #ffffff !important;
    }

    /* Make the "המיקום שלי" button text white in dark mode */
    html.dark #getLocationBtn {
      color: #ffffff !important;
    }

    /* Make the theme toggle button text white in dark mode */
    html.dark #themeToggle {
      color: #ffffff !important;
    }

    /* Make the "הצג את כל התאריכים" button background the same as the "חפש תורים" button */
    #toggleEarliestBtn.btn-outline-primary {
      background: #0d6efd !important;
      border-color: #0d6efd !important;
      color: #ffffff !important;
    }

    /* Dark mode specific styling for the button */
    html.dark #toggleEarliestBtn.btn-outline-primary {
      color: #ffffff !important;
    }
  </style>

  {% block styles %}{% endblock %}
</head>
<body>

<!-- Background Gradients -->
<div class="background-gradients">
  <div class="gradient-layer gradient-1"></div>
  <div class="gradient-layer gradient-2"></div>
  <div class="gradient-layer gradient-3"></div>
  <div class="gradient-layer gradient-4"></div>
  <div class="gradient-layer gradient-5"></div>
  <div class="texture-overlay"></div>
</div>

<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4 sticky-top" style="direction: rtl;">
  <div class="container-fluid d-flex align-items-center" style="direction: ltr; justify-content: space-between;">
    <!-- Brand and theme toggle on left -->
    <div class="d-flex align-items-center gap-3">
      <a class="navbar-brand" href="{{ url_for('index') }}">BookGov</a>
      <button id="themeToggle" class="btn btn-outline-secondary btn-sm" type="button" aria-label="Toggle theme">
        <svg id="darkModeIcon" class="theme-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <svg id="lightModeIcon" class="theme-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <path d="M12 1v2"></path>
          <path d="M12 21v2"></path>
          <path d="M4.22 4.22l1.42 1.42"></path>
          <path d="M18.36 18.36l1.42 1.42"></path>
          <path d="M1 12h2"></path>
          <path d="M21 12h2"></path>
          <path d="M4.22 19.78l1.42-1.42"></path>
          <path d="M18.36 5.64l1.42-1.42"></path>
        </svg>
        <span id="themeText">מצב כהה</span>
      </button>
    </div>

    <!-- Nav links centered -->
    <div class="collapse navbar-collapse justify-content-center" id="navbarNav" style="direction: rtl;">
		<ul class="navbar-nav d-flex align-items-center" style="gap: 2rem;">
		  <li class="nav-item">
			<a class="nav-link" href="{{ url_for('index') }}">בית</a>
		  </li>
		  <!-- Vertical divider -->
		  <li style="border-left: 1px solid #888; height: 24px; margin: 0 1rem;"></li>
		  <li class="nav-item">
			<a class="nav-link" href="{{ url_for('faq') }}">שאלות נפוצות</a>
		  </li>
		  <!-- Vertical divider -->
		  <li style="border-left: 1px solid #888; height: 24px; margin: 0 1rem;"></li>
		  <li class="nav-item">
			<a class="nav-link" href="{{ url_for('about') }}">אודות</a>
		  </li>
		</ul>

    </div>

    <!-- Hamburger toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

  <div class="container mt-4">
    {% block content %}{% endblock %}
  </div>

  <!-- Confirmation Modal (added here so it’s always on the page) -->
  <div id="confirmationModal" style="display:none;">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <p id="confirmationMessage"></p>
      <button id="confirmBtn" class="btn btn-success">אשר</button>
      <button id="cancelBtn" class="btn btn-secondary">בטל</button>
    </div>
  </div>

  <!-- Bootstrap JS and Popper with defer for better performance -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" defer></script>

  {% block scripts %}
  <!-- JavaScript files with defer for better performance -->
  <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/sortAppointments.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/dateFilter.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/distanceFilter.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/email_field.js') }}" defer></script>
  
  <script>
    (function() {
      const btn = document.getElementById('themeToggle');
      function apply(labelOnly=false){
        const isDark = document.documentElement.classList.contains('dark');
        console.log('Theme toggle - isDark:', isDark);
        console.log('HTML classes:', document.documentElement.classList.toString());
        if(btn) {
          const darkIcon = document.getElementById('darkModeIcon');
          const lightIcon = document.getElementById('lightModeIcon');
          const themeText = document.getElementById('themeText');

          if (isDark) {
            darkIcon.style.display = 'none';
            lightIcon.style.display = 'inline-block';
            themeText.textContent = 'מצב בהיר';
          } else {
            darkIcon.style.display = 'inline-block';
            lightIcon.style.display = 'none';
            themeText.textContent = 'מצב כהה';
          }
        }
        if(!labelOnly){
          try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch(e) {}
        }
      }
      if(btn){
        btn.addEventListener('click', () => {
          console.log('Theme toggle clicked');
          document.documentElement.classList.toggle('dark');
          console.log('After toggle - HTML classes:', document.documentElement.classList.toString());
          apply();
        });
        apply(true);
      }
    })();
  </script>
  {% endblock %}
</body>
</html>
