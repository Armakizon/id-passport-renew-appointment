<!-- templates/partials/location_dropdown.html -->
<form id="locationSelectForm" class="mb-3">
  <select id="locationDropdown" class="form-select">
    <option selected value="">üìç Choose a branch</option>
    {% for id, info in branch_map.items() %}
      <option value="{{ info.lat }},{{ info.lon }}">
        {{ info.name }} - {{ info.address }}
      </option>
    {% endfor %}
  </select>
</form>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const dropdown = document.getElementById("locationDropdown");

    dropdown?.addEventListener("change", () => {
      const [selectedLat, selectedLon] = dropdown.value.split(",");

      const allRows = document.querySelectorAll("#appointmentsTable tbody tr");

      allRows.forEach(row => {
        const rowLat = row.getAttribute("data-lat");
        const rowLon = row.getAttribute("data-lon");

        const matches = selectedLat === rowLat && selectedLon === rowLon;
        const showAll = dropdown.selectedIndex === 0 || dropdown.value === "";

        row.style.display = matches || showAll ? "" : "none";
      });
    });
  });
</script>
