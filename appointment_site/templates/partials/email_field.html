<form id="notifyForm" method="POST" action="/subscribe">
  <div class="mb-3">
    <label for="email" class="form-label">Email address</label>
    <input type="email" class="form-control" id="email" name="email" required>
  </div>

  <!-- Hidden input to store activeBranchIds -->
  <input type="hidden" name="locations" id="locationsInput">
  <input type="hidden" name="fromdate" id="fromDateInput">
  <input type="hidden" name="todate" id="toDateInput">
  <button type="submit" class="btn btn-primary">Notify Me</button>
</form>

<!-- Custom modal container -->
<div id="confirmationModal" style="display:none;">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <p id="confirmationMessage"></p>
    <button id="confirmBtn" class="btn btn-success">Confirm</button>
    <button id="cancelBtn" class="btn btn-secondary">Cancel</button>
  </div>
</div>

<style>
  #confirmationModal {
    position: fixed;
    top: 0;
    left: 0;
    right:0;
    bottom:0;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal-overlay {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
  }
  .modal-content {
    position: relative;
    background: white;
    padding: 20px 30px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    max-width: 400px;
    z-index: 1001;
    text-align: center;
  }
  .modal-content p {
    margin-bottom: 20px;
  }
  .modal-content button {
    margin: 0 10px;
  }
</style>

<script>
  const form = document.getElementById("notifyForm");
  const modal = document.getElementById("confirmationModal");
  const messageEl = document.getElementById("confirmationMessage");
  const confirmBtn = document.getElementById("confirmBtn");
  const cancelBtn = document.getElementById("cancelBtn");

form.addEventListener("submit", function (event) {
  event.preventDefault();

  // Fill hidden inputs as before
  document.getElementById("locationsInput").value = JSON.stringify(window.activeBranchIds || []);
  document.getElementById("fromDateInput").value = document.getElementById("startDate")?.value || "";
  document.getElementById("toDateInput").value = document.getElementById("endDate")?.value || "";

  // Build branch names from buttons
  const locationButtons = document.getElementById("locationButtons");
  const branchNames = [];
  if (locationButtons) {
    locationButtons.querySelectorAll("button.location-btn").forEach(btn => {
      branchNames.push(btn.textContent.trim());
    });
  }

  const branchList = branchNames.length > 0 ? branchNames.join(", ") : "no branches selected";

  // Set confirmation message HTML with line breaks
	messageEl.innerHTML = `You are about to sign up to get notified for these branches:<br><strong>${branchList}</strong><br><br>
	From: <strong>${document.getElementById("startDate")?.value || "any date"}</strong><br>
	To: <strong>${document.getElementById("endDate")?.value || "any date"}</strong>.<br><br>
	Proceed?`;

  modal.style.display = "flex";
});

  confirmBtn.addEventListener("click", () => {
    modal.style.display = "none";
    form.submit();
  });

  cancelBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });
</script>
